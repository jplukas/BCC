\BeforeBeginEnvironment{lstlisting}{\par\noindent\begin{minipage}{\linewidth}}
    \AfterEndEnvironment{lstlisting}{\end{minipage}\par\addvspace{\topskip}}
    
\lstset{
    basicstyle=\ttfamily,
    columns=fullflexible,
    frame=single,
    breaklines=true,
    postbreak=\mbox{\textcolor{red}{$\hookrightarrow$}\space},
    }